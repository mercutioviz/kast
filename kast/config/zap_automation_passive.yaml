# OWASP ZAP Automation Framework Plan - PASSIVE Profile
# Passive-only scan for production monitoring (no active testing)
# Estimated duration: ~15 minutes
# Safe for production - only observes traffic, does not inject payloads

env:
  contexts:
    - name: "target-context"
      urls:
        - "${TARGET_URL}"
      includePaths:
        - "${TARGET_URL}"
      excludePaths:
        - ".*logout.*"
        - ".*signout.*"
  parameters:
    failOnError: true
    failOnWarning: false
    progressToStdout: true

jobs:
  # Spider to discover pages (passive, no testing)
  - type: "spiderClient"
    parameters:
      maxDuration: 10  # 10 minutes
      maxDepth: 5
      maxChildren: 0
      acceptCookies: true
      handleODataParametersVisited: false
      parseComments: true
      parseGit: true
      parseRobotsTxt: true
      parseSitemapXml: true
      parseSVNEntries: true
      postForm: true
      processForm: true
      requestWaitTime: 300  # Slower to be gentle on production
      sendRefererHeader: true
      threadCount: 1  # Single thread for production

  # Passive scan only - analyze responses without sending attack payloads
  - type: "passiveScan-config"
    parameters:
      maxAlertsPerRule: 10
      scanOnlyInScope: true
      enableTags: false

  - type: "passiveScan-wait"
    parameters:
      maxDuration: 10

  # NO ACTIVE SCAN - This is the key difference for production safety

  # Generate report
  - type: "report"
    parameters:
      template: "traditional-json"
      reportDir: "/zap/reports"
      reportFile: "zap_report.json"
      reportTitle: "KAST ZAP Passive Scan"
      reportDescription: "Passive-only security scan safe for production"
      displayReport: false
