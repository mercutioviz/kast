# OWASP ZAP Automation Framework Plan - THOROUGH Profile
# Comprehensive deep scan for pre-production and major releases
# Estimated duration: ~90 minutes

env:
  contexts:
    - name: "target-context"
      urls:
        - "${TARGET_URL}"
      includePaths:
        - ".*"
      excludePaths:
        - ".*logout.*"
        - ".*signout.*"
  parameters:
    failOnError: true
    failOnWarning: false
    progressToStdout: true

jobs:
  # Deep spider scan
  - type: "spiderClient"
    parameters:
      maxDuration: 20  # 20 minutes
      maxDepth: 10     # Deep crawl
      maxChildren: 0
      acceptCookies: true
      handleODataParametersVisited: true
      parseComments: true
      parseGit: true
      parseRobotsTxt: true
      parseSitemapXml: true
      parseSVNEntries: true
      postForm: true
      processForm: true
      requestWaitTime: 200
      sendRefererHeader: true
      threadCount: 4  # More threads

  # Comprehensive passive scan
  - type: "passiveScan-config"
    parameters:
      maxAlertsPerRule: 20  # More alerts per rule
      scanOnlyInScope: true
      enableTags: true

  - type: "passiveScan-wait"
    parameters:
      maxDuration: 15

  # Thorough active scan
  - type: "activeScan"
    parameters:
      context: "target-context"
      policy: "Default Policy"
      maxRuleDurationInMins: 10
      maxScanDurationInMins: 60  # 60 minutes
      addQueryParam: false
      defaultPolicy: ""
      delayInMs: 0
      handleAntiCSRFTokens: true
      injectPluginIdInHeader: false
      scanHeadersAllRequests: true
      threadPerHost: 4  # More threads for thorough testing

  # Generate report
  - type: "report"
    parameters:
      template: "traditional-json"
      reportDir: "/zap/reports"
      reportFile: "zap_report.json"
      reportTitle: "KAST ZAP Thorough Scan"
      reportDescription: "Comprehensive deep security scan for pre-production"
      displayReport: false
