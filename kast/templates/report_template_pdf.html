<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KAST Security Report{% if target %} - {{ target }}{% endif %}</title>
    <link rel="stylesheet" href="kast_style_pdf.css">
</head>
<body>
    <!-- Cover Page -->
    <div class="cover-page" id="home">
        {% if logo_base64 %}
        <img src="{{ logo_base64 }}" alt="KAST Logo" class="cover-logo">
        {% endif %}
        <h1 class="cover-title">Security Scan Report</h1>
        {% if target %}
        <div class="cover-target">{{ target }}</div>
        {% endif %}
        <div class="cover-date">{{ scan_metadata.scan_date }}</div>
        
        <div class="severity-summary">
            <a href="#issues-high" class="severity-box-link">
                <div class="severity-box high">
                    <div class="severity-count">{{ scan_metadata.severity_counts.High }}</div>
                    <div class="severity-label">High</div>
                </div>
            </a>
            <a href="#issues-medium" class="severity-box-link">
                <div class="severity-box medium">
                    <div class="severity-count">{{ scan_metadata.severity_counts.Medium }}</div>
                    <div class="severity-label">Medium</div>
                </div>
            </a>
            <a href="#issues-low" class="severity-box-link">
                <div class="severity-box low">
                    <div class="severity-count">{{ scan_metadata.severity_counts.Low }}</div>
                    <div class="severity-label">Low</div>
                </div>
            </a>
            <a href="#issues-info" class="severity-box-link">
                <div class="severity-box info">
                    <div class="severity-count">{{ scan_metadata.severity_counts.Info }}</div>
                    <div class="severity-label">Info</div>
                </div>
            </a>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="section" id="exec-summary">
        <h1 class="section-title">Executive Summary</h1>
        
        {% if plugin_executive_summaries %}
        <h2 class="subsection-title">Scan Findings</h2>
        {% for summary in plugin_executive_summaries %}
        <div class="summary-block">
            <div class="summary-plugin">
                {{ summary.plugin_name }}
                <a href="#tool-{{ summary.plugin_name|lower|replace(' ', '-')|replace('.', '-') }}" class="inline-nav-link">View Details →</a>
            </div>
            {{ summary.summary|safe }}
        </div>
        {% endfor %}
        {% endif %}
        
        <h2 class="subsection-title">Identified Issues</h2>
        <div class="summary-block">
            {{ executive_summary|safe }}
        </div>
        <div class="summary-nav">
            <a href="#issues-found" class="nav-link">View All Issues by Severity →</a>
        </div>
    </div>

    <div class="page-break"></div>

    <!-- Issues by Severity -->
    <div class="section" id="issues-found">
        <h1 class="section-title">Issues Found</h1>
        
        {% if not issues %}
        <p class="no-issues">No security issues were identified during this scan.</p>
        {% else %}
        
        {% set high_issues = issues|selectattr("severity", "equalto", "High")|list %}
        {% set medium_issues = issues|selectattr("severity", "equalto", "Medium")|list %}
        {% set low_issues = issues|selectattr("severity", "equalto", "Low")|list %}
        {% set info_issues = issues|selectattr("severity", "equalto", "Info")|list %}
        
        {% if high_issues %}
        <div class="severity-section" id="issues-high">
            <h2 class="severity-heading high">High Severity Issues</h2>
            {% for issue in high_issues %}
            <div class="issue high">
                <div class="issue-title">
                    {{ issue.display_name if issue.display_name else issue.id }}
                    <span class="issue-category">{{ issue.category }}</span>
                </div>
                <div class="issue-meta">
                    <strong>Reported by:</strong> {{ issue.reported_by }}
                    <a href="#tool-{{ issue.reported_by_tool|lower|replace(' ', '-')|replace('.', '-') }}" class="issue-tool-link">View tool details →</a>
                </div>
                {% if issue.description and issue.description != issue.id %}
                <div class="issue-description">{{ issue.description }}</div>
                {% endif %}
                <div class="issue-remediation">
                    <strong>Remediation:</strong> {{ issue.remediation }}
                </div>
            </div>
            {% endfor %}
            <div class="section-nav">
                <a href="#home" class="back-link">↑ Home</a>
            </div>
        </div>
        {% endif %}
        
        {% if medium_issues %}
        <div class="severity-section" id="issues-medium">
            <h2 class="severity-heading medium">Medium Severity Issues</h2>
            {% for issue in medium_issues %}
            <div class="issue medium">
                <div class="issue-title">
                    {{ issue.display_name if issue.display_name else issue.id }}
                    <span class="issue-category">{{ issue.category }}</span>
                </div>
                <div class="issue-meta">
                    <strong>Reported by:</strong> {{ issue.reported_by }}
                    <a href="#tool-{{ issue.reported_by_tool|lower|replace(' ', '-')|replace('.', '-') }}" class="issue-tool-link">View tool details →</a>
                </div>
                {% if issue.description and issue.description != issue.id %}
                <div class="issue-description">{{ issue.description }}</div>
                {% endif %}
                <div class="issue-remediation">
                    <strong>Remediation:</strong> {{ issue.remediation }}
                </div>
            </div>
            {% endfor %}
            <div class="section-nav">
                <a href="#home" class="back-link">↑ Home</a>
            </div>
        </div>
        {% endif %}
        
        {% if low_issues %}
        <div class="severity-section" id="issues-low">
            <h2 class="severity-heading low">Low Severity Issues</h2>
            {% for issue in low_issues %}
            <div class="issue low">
                <div class="issue-title">
                    {{ issue.display_name if issue.display_name else issue.id }}
                    <span class="issue-category">{{ issue.category }}</span>
                </div>
                <div class="issue-meta">
                    <strong>Reported by:</strong> {{ issue.reported_by }}
                    <a href="#tool-{{ issue.reported_by_tool|lower|replace(' ', '-')|replace('.', '-') }}" class="issue-tool-link">View tool details →</a>
                </div>
                {% if issue.description and issue.description != issue.id %}
                <div class="issue-description">{{ issue.description }}</div>
                {% endif %}
                <div class="issue-remediation">
                    <strong>Remediation:</strong> {{ issue.remediation }}
                </div>
            </div>
            {% endfor %}
            <div class="section-nav">
                <a href="#home" class="back-link">↑ Home</a>
            </div>
        </div>
        {% endif %}
        
        {% if info_issues %}
        <div class="severity-section" id="issues-info">
            <h2 class="severity-heading info">Informational</h2>
            {% for issue in info_issues %}
            <div class="issue info">
                <div class="issue-title">
                    {{ issue.display_name if issue.display_name else issue.id }}
                    <span class="issue-category">{{ issue.category }}</span>
                </div>
                <div class="issue-meta">
                    <strong>Reported by:</strong> {{ issue.reported_by }}
                    <a href="#tool-{{ issue.reported_by_tool|lower|replace(' ', '-')|replace('.', '-') }}" class="issue-tool-link">View tool details →</a>
                </div>
                {% if issue.description and issue.description != issue.id %}
                <div class="issue-description">{{ issue.description }}</div>
                {% endif %}
                <div class="issue-remediation">
                    <strong>Remediation:</strong> {{ issue.remediation }}
                </div>
            </div>
            {% endfor %}
            <div class="section-nav">
                <a href="#home" class="back-link">↑ Home</a>
            </div>
        </div>
        {% endif %}
        
        {% endif %}
    </div>

    <div class="page-break"></div>

    <!-- Tool Index Page -->
    <div class="section" id="tool-index">
        <h1 class="section-title">Detailed Results by Tool</h1>
        
        <div class="tool-index">
            <p class="tool-index-intro">This section provides detailed results from each security tool that was executed during the scan. Click on any tool name below to navigate directly to its results.</p>
            
            <div class="tool-index-grid">
                {% for tool_name, tool in detailed_results.items() %}
                <div class="tool-index-item">
                    <a href="#tool-{{ tool_name|lower|replace(' ', '-')|replace('.', '-') }}" class="tool-index-link">
                        <div class="tool-index-name">{{ tool.display_name if tool.display_name else tool_name }}</div>
                        {% if tool.purpose %}
                        <div class="tool-index-purpose">{{ tool.purpose }}</div>
                        {% endif %}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="page-break"></div>

    <!-- Detailed Tool Results -->
    <div class="section">
        {% for tool_name, tool in detailed_results.items() %}
        <div class="tool" id="tool-{{ tool_name|lower|replace(' ', '-')|replace('.', '-') }}">
            <div class="tool-nav-header">
                <a href="#tool-index" class="tool-nav-link">← Back to Tool Index</a>
                <a href="#home" class="tool-nav-link">↑ Home</a>
                {% if not loop.first %}
                <a href="#tool-{{ loop.previtem[0]|lower|replace(' ', '-')|replace('.', '-') }}" class="tool-nav-link">← Previous</a>
                {% endif %}
                {% if not loop.last %}
                <a href="#tool-{{ loop.nextitem[0]|lower|replace(' ', '-')|replace('.', '-') }}" class="tool-nav-link">Next →</a>
                {% endif %}
            </div>
            <h2 class="tool-name">{{ tool.display_name if tool.display_name else tool_name }}</h2>
            
            <div class="tool-info">
                {% if tool.purpose %}
                <div class="tool-row"><strong>Purpose:</strong> {{ tool.purpose }}</div>
                {% endif %}
                {% if tool.website_url %}
                <div class="tool-row"><strong>Website:</strong> {{ tool.website_url }}</div>
                {% endif %}
                {% if tool.timestamp %}
                <div class="tool-row"><strong>Timestamp:</strong> {{ tool.timestamp }}</div>
                {% endif %}
                {% if tool.disposition %}
                <div class="tool-row"><strong>Disposition:</strong> {{ tool.disposition }}</div>
                {% endif %}
            </div>
            
            {% if tool.summary %}
            <div class="tool-summary">
                <strong>Summary:</strong>
                {{ tool.summary|safe }}
            </div>
            {% endif %}
            
            {% if tool.custom_html %}
            <div class="tool-custom">
                {{ tool.custom_html|safe }}
            </div>
            {% endif %}
            
            {% if tool.details %}
            <div class="tool-summary">
                <strong>Details:</strong>
                {{ tool.details|safe }}
            </div>
            {% endif %}
            
            {% if tool.results_message %}
            <div class="tool-summary">
                <strong>Results:</strong>
                <div style="padding: 0.5em 0; color: #075985; font-weight: 500;">{{ tool.results_message }}</div>
            </div>
            {% elif tool.results_html %}
            <div class="tool-summary">
                <strong>Results:</strong>
                <div class="json-container">{{ tool.results_html|safe }}</div>
            </div>
            {% endif %}
            
            {% if tool.report %}
            <div class="tool-summary">
                <strong>Report Notes:</strong>
                {{ tool.report|safe }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Footer Elements -->
    <div class="footer-left">
        {% if logo_base64 %}
        <img src="{{ logo_base64 }}" alt="KAST" class="footer-logo">
        {% endif %}
        KAST Security Scanner
    </div>
    
    <div class="footer-center">
        {% if target %}{{ target }}{% endif %}
    </div>
    
    <div class="footer-right">
        {{ scan_metadata.scan_date }}
    </div>
</body>
</html>
